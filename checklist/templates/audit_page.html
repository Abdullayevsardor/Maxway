{% extends "base.html" %}

{% block title %}Audit Natijalari{% endblock %}

{% block content %}

<h2>Audit natijalari</h2>

<form method="GET" class="filters">
    <select name="filial">
        <option value="all">Barcha filiallar</option>
        {% for f in all_filials %}
            <option value="{{ f }}" {% if request.GET.filial == f %}selected{% endif %}>{{ f }}</option>
        {% endfor %}
    </select>

    <input type="date" name="from" value="{{ request.GET.from }}">
    <input type="date" name="to" value="{{ request.GET.to }}">
    <button type="submit">Filtrlash</button>

    <div class="export-buttons">
        <!-- Excel Export -->
        <a href="{% url 'audit_export_excel' %}?{% if request.GET.filial %}filial={{ request.GET.filial }}&{% endif %}{% if request.GET.from %}from={{ request.GET.from }}&{% endif %}{% if request.GET.to %}to={{ request.GET.to }}{% endif %}"
           class="excel">Excel Export</a>

        <!-- PDF Export -->
        <a href="{% url 'audit_export_pdf' %}?{% if request.GET.filial %}filial={{ request.GET.filial }}&{% endif %}{% if request.GET.from %}from={{ request.GET.from }}&{% endif %}{% if request.GET.to %}to={{ request.GET.to }}{% endif %}"
           class="pdf">PDF Export</a>
    </div>
</form>
<!-- ================= DESKTOP TABLE ================= -->
<div class="desktop-only">
  <table class="audit-table">
    <thead>
      <tr>
        <th>Filial</th>
        <th>Foiz</th>
        <th>Sana</th>
        <th>Amallar</th>
      </tr>
    </thead>
    <tbody>
      {% for audit in audits %}
      <tr>
        <td>
          <a href="{% url 'audit_filial_detail' audit.filial_nomi %}">
            {{ audit.filial_nomi }}
          </a>
        </td>
        <td>{{ audit.percent }}%</td>
        <td>{{ audit.created_at|date:"Y-m-d H:i" }}</td>
        <td>
          <form method="POST" action="{% url 'audit_delete' audit.id %}"
                onsubmit="return confirm('Rostdan ham o‘chirmoqchimisiz?');">
            {% csrf_token %}
            <button type="submit" class="danger-btn">O‘chirish</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ================= MOBILE CARDS ================= -->
<div class="mobile-only">
  {% for audit in audits %}
  <div class="audit-card">
    <div><strong>Filial:</strong> {{ audit.filial_nomi }}</div>
    <div><strong>Foiz:</strong> {{ audit.percent }}%</div>
    <div><strong>Sana:</strong> {{ audit.created_at|date:"Y-m-d H:i" }}</div>

    <a href="{% url 'audit_filial_detail' audit.filial_nomi %}"
       class="card-link">Batafsil</a>

    <form method="POST" action="{% url 'audit_delete' audit.id %}"
          onsubmit="return confirm('Rostdan ham o‘chirmoqchimisiz?');">
      {% csrf_token %}
      <button type="submit" class="danger-btn full">O‘chirish</button>
    </form>
  </div>
  {% endfor %}
</div>

{% endblock %}

 