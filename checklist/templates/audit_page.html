{% extends "base.html" %}

{% block title %}Audit Natijalari{% endblock %}

{% block content %}

<h2>Audit natijalari</h2>

<form method="GET" class="filters">
    <select name="filial">
        <option value="all">Barcha filiallar</option>
        {% for f in all_filials %}
            <option value="{{ f }}" {% if request.GET.filial == f %}selected{% endif %}>{{ f }}</option>
        {% endfor %}
    </select>

    <input type="date" name="from" value="{{ request.GET.from }}">
    <input type="date" name="to" value="{{ request.GET.to }}">
    <button type="submit">Filtrlash</button>

    <div class="export-buttons">
        <!-- Excel Export -->
        <a href="{% url 'audit_export_excel' %}?{% if request.GET.filial %}filial={{ request.GET.filial }}&{% endif %}{% if request.GET.from %}from={{ request.GET.from }}&{% endif %}{% if request.GET.to %}to={{ request.GET.to }}{% endif %}"
           class="excel">Excel Export</a>

        <!-- PDF Export -->
        <a href="{% url 'audit_export_pdf' %}?{% if request.GET.filial %}filial={{ request.GET.filial }}&{% endif %}{% if request.GET.from %}from={{ request.GET.from }}&{% endif %}{% if request.GET.to %}to={{ request.GET.to }}{% endif %}"
           class="pdf">PDF Export</a>
    </div>
</form>

<table>
    <thead>
        <tr>
            <th>Filial nomi</th>
            <th>Umumiy foiz</th>
            <th>Sana</th>
            <th>Amallar</th>
        </tr>
    </thead>

    <tbody>
        {% for audit in audits %}
        <tr>
            <td>
                <a href="{% url 'audit_filial_detail' audit.filial_nomi %}">
                    {{ audit.filial_nomi }}
                </a>
            </td>
            <td>{{ audit.percent }}%</td>
            <td>{{ audit.created_at|date:"Y-m-d H:i" }}</td>
            <td>
                <form method="POST" action="{% url 'audit_delete' audit.id %}"
                      onsubmit="return confirm('Rostdan ham o‘chirmoqchimisiz?');">
                    {% csrf_token %}
                    <button type="submit"
                            style="background:#f44336;color:white;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;">
                        O‘chirish
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}


{% block extra_head %}
<style>
/* 1. Umumiy asoslar */
body { font-family: Arial, sans-serif; padding: 15px; background: #eef3f4; margin: 0; }
h2 { text-align: center; margin-bottom: 20px; font-size: 1.4rem; }

/* 2. Filtrlar qatorini to'g'irlash */
.filters {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}

/* 3. Inputlar va Selectlar */
.filters select, 
.filters input[type="date"] {
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 6px;
    flex: 1 1 140px; /* Mobilda moslashuvchan, lekin juda kichik emas */
}

.filters button {
    padding: 10px 15px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    flex: 1 1 100%; /* Mobilda tugma to'liq kenglikda */
}

/* 4. Eksport tugmalari */
.export-buttons {
    display: flex;
    gap: 10px;
    width: 100%; /* Mobilda to'liq kenglik */
    margin-top: 5px;
}

.export-buttons a {
    flex: 1;
    padding: 8px;
    text-align: center;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 13px;
    font-weight: bold;
}

.export-buttons a.excel { background: #2196F3; }
.export-buttons a.pdf { background: #f44336; }

/* 5. Jadvalni mobilga moslash */
table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
}

th, td {
    border: 1px solid #ddd;
    padding: 10px 5px;
    text-align: center;
    font-size: 13px;
}

th {
    background: #d3edf4;
    font-weight: bold;
}

td a {
    font-weight: bold;
    color: #2196F3;
    text-decoration: none;
}

/* 6. Faqat mobil uchun (maxsus tweaklar) */
@media (max-width: 600px) {
    .filters { padding: 10px; gap: 8px; }
    
    /* Jadvalning ba'zi ustunlarini biroz qisqartirish */
    th, td { font-size: 12px; }
    
    /* Sana ustunini sig'dirish uchun */
    td:nth-child(3) { font-size: 11px; }

    /* Tugma hover effektlari mobilda shart emas */
    .filters button:active { transform: scale(0.98); }
}
</style>
{% endblock %}
