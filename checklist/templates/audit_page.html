{% extends "base.html" %}
{% block title %}Детали аудита{% endblock %}

{% block content %}
<div class="container">
    <h2>Детали аудита</h2>

    <form method="GET" class="filter-export-bar">
        <div class="filters">
            <select name="filial">
                <option value="all">Все филиалы</option>
                {% for f in all_filials %}
                    <option value="{{ f }}" {% if request.GET.filial == f %}selected{% endif %}>
                        {{ f }}
                    </option>
                {% endfor %}
            </select>

            <input type="date" name="from" value="{{ request.GET.from }}">
            <input type="date" name="to" value="{{ request.GET.to }}">

            <button type="submit" class="btn filter-btn">Фильтрация</button>
        </div>

        <div class="export-buttons">
            <a href="{% url 'audit_export_excel' %}?{% if request.GET.filial %}filial={{ request.GET.filial }}&{% endif %}{% if request.GET.from %}from={{ request.GET.from }}&{% endif %}{% if request.GET.to %}to={{ request.GET.to }}{% endif %}"
               class="excel">
                 Экспорт в Excel
            </a>
        </div>
    </form>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Филиал</th>
                    <th>Итого</th>
                    <th>Дата</th>
                    <th>Действие</th>
                </tr>
            </thead>
            <tbody>
                {% for audit in audits %}
                <tr>
                    <td>
                        <a href="{% url 'audit_filial_detail' audit.filial_nomi %}">
                            {{ audit.filial_nomi }}
                        </a>
                    </td>
                    <td><b>{{ audit.percent }}%</b></td>
                    <td>{{ audit.created_at|date:"d.m.Y" }}</td>
                    <td>
                        <form method="POST" action="{% url 'audit_delete' audit.id %}" onsubmit="return confirm('Удалить?');">
                            {% csrf_token %}
                            <button type="submit" class="del-btn">Удалить</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_head %}
<style>
    /* 1. Umumiy asoslar */
    body { font-family: Arial, sans-serif; background:#f4f6f7; margin: 0; padding: 20px; color: #333; }
    h2 { text-align: center; margin-bottom: 20px; }
    .container { max-width: 1200px; margin: 0 auto; padding-bottom: 50px; }

    /* 2. Filtrlar va Export paneli */
    .filter-export-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 15px;
        background: #fff;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }

    .filters {
        display: flex;
        flex: 1;
        gap: 10px;
        align-items: center;
    }

    .filters select, .filters input {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        outline: none;
    }

    /* 3. Tugmalar */
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        background: #2f7df6;
        color: #fff;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
    }
    .btn:hover { background: #1a66d9; }

    .excel {
        background: #217346;
        color: #fff;
        padding: 10px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 14px;
        font-weight: bold;
        display: inline-block;
    }

    /* 4. Jadval dizayni */
    .table-wrap {
        background: #fff;
        border-radius: 12px;
        overflow-x: auto;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 500px;
    }

    th, td {
        padding: 12px;
        text-align: center;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }

    th { background: #f8f9fa; font-weight: bold; color: #666; }
    td:first-child { text-align: left; font-weight: 500; }

    .del-btn {
        background: #f44336;
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
    }

    /* 5. Mobile (Moslashuvchanlik) */
    @media (max-width: 768px) {
        .filter-export-bar {
            flex-direction: column;
            align-items: stretch;
        }

        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Ikki ustunli qator */
            gap: 10px;
        }

        /* Tugma o'ngda turishi uchun */
        .filter-btn {
            grid-column: 2; /* 2-ustunga o'tadi */
            justify-self: end; /* O'ngga tekislanadi */
            width: auto;
            min-width: 120px;
        }

        .filters select, .filters input {
            width: 100%;
        }

        .export-buttons .excel {
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }

        th, td { padding: 8px 5px; font-size: 12px; }
    }
</style>
{% endblock %}
